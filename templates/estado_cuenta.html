<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>Estado de Cuenta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="fs-5 container mt-4">

<h3>üí∞ Estado de Cuenta</h3>

<!-- FILTRO + EXPORTAR -->
<div class="row align-items-end mb-4">

    <form method="get" class="col-md-8 row g-2">
        <div class="col-md-6">
            <input
                type="text"
                name="casa"
                class="form-control"
                placeholder="Filtrar por casa (Ej: A-12)"
                value="{{ casa or '' }}"
            >
        </div>
        <div class="col-md-3">
            <button class="btn btn-lg btn-primary w-100">
                Filtrar
            </button>
        </div>

        {% if casa %}
        <div class="col-md-3">
            <a href="/estado-cuenta" class="btn btn-lg btn-secondary w-100">
                Ver todo
            </a>
        </div>
        {% endif %}
    </form>

    <!-- BOT√ìN EXCEL -->
    <div class="col-md-4 text-end">
        <a
          href="/estado-cuenta/excel{% if casa %}?casa={{ casa }}{% endif %}"
          class="btn btn-lg btn-success"
        >
            üì• Descargar Excel
        </a>
    </div>
</div>

{% if casa %}
<div class="alert alert-warning">
    üìå Mostrando estado de cuenta de la casa <strong>{{ casa }}</strong>
</div>
{% endif %}

<!-- RESUMEN -->
<div class="row text-center mb-4">
    <div class="col-md-4">
        <div class="alert alert-success">
            Ingresos<br>
            <strong>${{ ingresos }}</strong>
        </div>
    </div>
    <div class="col-md-4">
        <div class="alert alert-danger">
            Gastos<br>
            <strong>${{ gastos_total }}</strong>
        </div>
    </div>
    <div class="col-md-4">
        <div class="alert alert-info">
            Disponible<br>
            <strong>${{ disponible }}</strong>
        </div>
    </div>
</div>

<hr>

<!-- PAGOS -->
<h5>üè† Aportes por Casa</h5>

<div class="table-responsive">
<table class="table table-bordered table-sm">
    <thead class="table-light">
        <tr>
            <th>Casa</th>
            <th>Monto</th>
            <th>Fecha</th>
            <th>Notas</th>
            <th>Comprobante</th>
        </tr>
    </thead>
    <tbody>
        {% for p in pagos %}
        <tr>
            <td>{{ p['casa'] }}</td>
            <td>${{ p['monto'] }}</td>
            <td>{{ p['fecha'] }}</td>

            <td class="text-wrap" style="max-width:300px">
                {{ p['notas'] if p['notas'] else '‚Äî' }}
            </td>

            <td>
                {% if p['comprobante'] %}
                    {% if p['comprobante'].endswith('.pdf') %}
                        <a href="{{ p['comprobante'] }}?response-content-disposition=inline"
                           target="_blank">
                            üìÑ Ver PDF
                        </a>
                    {% else %}
                        <a href="{{ p['comprobante'] }}" target="_blank">
                            <img src="{{ p['comprobante'] }}"
                                 style="max-height:60px"
                                 class="img-thumbnail">
                        </a>
                    {% endif %}
                {% else %}
                    ‚Äî
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5" class="text-center text-muted">
                No hay pagos registrados
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<hr>

<!-- GASTOS -->
<h5>üßæ Gastos Ejecutados</h5>

<div class="table-responsive">
<table class="table table-bordered table-sm">
    <thead class="table-light">
        <tr>
            <th>Descripci√≥n</th>
            <th>Monto</th>
            <th>Fecha</th>
            <th>Factura</th>
        </tr>
    </thead>
    <tbody>
        {% for g in gastos %}
        <tr>
            <td>{{ g['descripcion'] }}</td>
            <td>${{ g['monto'] }}</td>
            <td>{{ g['fecha'] }}</td>
            <td>
                {% if g['factura'] %}
                    {% if g['factura'].endswith('.pdf') %}
                        <a href="{{ g['factura'] }}?response-content-disposition=inline"
                           target="_blank">
                            üìÑ Ver PDF
                        </a>
                    {% else %}
                        <a href="{{ g['factura'] }}" target="_blank">
                            <img src="{{ g['factura'] }}"
                                 style="max-height:60px"
                                 class="img-thumbnail">
                        </a>
                    {% endif %}
                {% else %}
                    ‚Äî
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4" class="text-center text-muted">
                No hay gastos registrados
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>

<div class="mt-4">
    <a href="/" class="btn btn-lg btn-secondary">
        ‚¨Ö Volver al inicio
    </a>
</div>

</body>
</html>
