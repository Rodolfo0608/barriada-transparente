<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Estado de Cuenta</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="container mt-4">

<h3>üí∞ Estado de Cuenta</h3>

<!-- FILTRO + EXPORTAR -->
<div class="row align-items-end mb-4">

    <form method="get" class="col-md-8 row g-2">
        <div class="col-md-6">
            <input
                type="text"
                name="casa"
                class="form-control"
                placeholder="Filtrar por casa (Ej: A-12)"
                value="{{ casa or '' }}"
            >
        </div>
        <div class="col-md-3">
            <button class="btn btn-primary w-100">
                Filtrar
            </button>
        </div>

        {% if casa %}
        <div class="col-md-3">
            <a href="/estado-cuenta" class="btn btn-secondary w-100">
                Ver todo
            </a>
        </div>
        {% endif %}
    </form>

    <!-- BOT√ìN EXCEL -->
    <div class="col-md-4 text-end">
        <a
          href="/estado-cuenta/excel{% if casa %}?casa={{ casa }}{% endif %}"
          class="btn btn-success"
        >
            üì• Descargar Excel
        </a>
    </div>
</div>

{% if casa %}
<div class="alert alert-warning">
    üìå Mostrando estado de cuenta de la casa <strong>{{ casa }}</strong>
</div>
{% endif %}

<!-- RESUMEN FINANCIERO -->
<div class="row text-center mb-4">
    <div class="col-md-4">
        <div class="alert alert-success">
            Ingresos<br>
            <strong>${{ ingresos }}</strong>
        </div>
    </div>
    <div class="col-md-4">
        <div class="alert alert-danger">
            Gastos<br>
            <strong>${{ gastos_total }}</strong>
        </div>
    </div>
    <div class="col-md-4">
        <div class="alert alert-info">
            Disponible<br>
            <strong>${{ disponible }}</strong>
        </div>
    </div>
</div>

<hr>

<!-- PAGOS -->
<h5>üè† Aportes por Casa</h5>

<table class="table table-bordered table-sm">
    <thead class="table-light">
        <tr>
            <th>Casa</th>
            <th>Monto</th>
            <th>Fecha</th>
            <th>Comprobante</th>
        </tr>
    </thead>
    <tbody>
        {% for p in pagos %}
        <tr>
            <td>{{ p['casa'] }}</td>
            <td>${{ p['monto'] }}</td>
            <td>{{ p['fecha'] }}</td>
            <td>
                {% if p['comprobante'] %}
                    <a href="{{ p['comprobante'] }}" target="_blank">Ver</a>
                {% else %}
                    ‚Äî
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4" class="text-center text-muted">
                No hay pagos registrados
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<hr>

<!-- GASTOS -->
<h5>üßæ Gastos Ejecutados</h5>

<table class="table table-bordered table-sm">
    <thead class="table-light">
        <tr>
            <th>Descripci√≥n</th>
            <th>Monto</th>
            <th>Fecha</th>
            <th>Factura</th>
        </tr>
    </thead>
    <tbody>
        {% for g in gastos %}
        <tr>
            <td>{{ g['descripcion'] }}</td>
            <td>${{ g['monto'] }}</td>
            <td>{{ g['fecha'] }}</td>
            <td>
                {% if g['factura'] %}
                    <a href="{{ g['factura'] }}" target="_blank">Ver</a>
                {% else %}
                    ‚Äî
                {% endif %}
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4" class="text-center text-muted">
                No hay gastos registrados
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="mt-4">
    <a href="/" class="btn btn-secondary">
        ‚¨Ö Volver al inicio
    </a>
</div>

</body>
</html>
