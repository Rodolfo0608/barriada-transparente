<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Detalle de Cuota</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet">

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
    </script>
</head>

<body class="container mt-4 fs-5">

<h3>ðŸ“Š {{ cuota.nombre }}</h3>

<p>
    <strong>Monto por casa:</strong> ${{ cuota.monto }}
</p>

<!-- ðŸ”¹ BOTÃ“N NUEVO -->
<a
  href="/admin/cuota/{{ cuota.id }}/estado"
  class="btn btn-outline-primary mb-3">
    ðŸ“Š Ver estado de cuenta
</a>

<div class="table-responsive">
<table class="table table-bordered table-sm align-middle">
    <thead class="table-light">
        <tr>
            <th>Casa</th>
            <th>Estado</th>
            <th>Monto</th>
            <th>Comprobante</th>
            <th>AcciÃ³n</th>
        </tr>
    </thead>
    <tbody>

    {% for c in casas %}
    <tr>
        <td>Casa {{ c.numero }}</td>

        {% if c.pago %}
            <td class="text-primary fw-bold">PagÃ³</td>
            <td>${{ c.pago.monto }}</td>
            <td>
                {% if c.pago.comprobante %}
                    <a href="{{ c.pago.comprobante }}" target="_blank">
                        Ver
                    </a>
                {% else %}
                    â€”
                {% endif %}
            </td>
            <td>â€”</td>
        {% else %}
            <td class="text-danger">Pendiente</td>
            <td>â€”</td>
            <td>â€”</td>
            <td>
                <button
                    class="btn btn-success btn-sm"
                    data-bs-toggle="modal"
                    data-bs-target="#pagarModal{{ c.numero }}">
                    Agregar pago
                </button>
            </td>
        {% endif %}
    </tr>

    <!-- MODAL PAGO -->
    <div class="modal fade" id="pagarModal{{ c.numero }}" tabindex="-1">
        <div class="modal-dialog">
            <form
              method="post"
              action="/admin/cuota/{{ cuota.id }}/pagar"
              enctype="multipart/form-data"
              class="modal-content"
              autocomplete="off">

                <div class="modal-header">
                    <h5 class="modal-title">
                        Pago Casa {{ c.numero }}
                    </h5>
                    <button type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">

                    <input type="hidden" name="casa" value="{{ c.numero }}">

                    <label class="form-label">Monto pagado</label>
                    <input
                        class="form-control mb-3"
                        name="monto"
                        type="number"
                        step="0.01"
                        required
                        autocomplete="off">

                    <label class="form-label">Comprobante</label>
                    <input
                        class="form-control"
                        type="file"
                        name="comprobante"
                        accept="application/pdf,image/*">

                </div>

                <div class="modal-footer">
                    <button class="btn btn-primary">
                        Guardar pago
                    </button>
                </div>
            </form>
        </div>
    </div>

    {% endfor %}

    </tbody>
</table>
</div>

<a href="/admin/cuotas" class="btn btn-lg btn-secondary mt-3">
    â¬… Volver a cuotas
</a>

</body>
</html>
